<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/common.css" />
		<link rel="stylesheet" href="../../css/style.css" />
		<link rel="stylesheet" type="text/css" href="../../css/iconfont.css">
	</head>

	<body>
		<!--头部-->

		<!--中间部分-->
		<div class="mui-content main" style="margin-bottom: 50px;background:#f5f5f5 ;" id="app">
			<!--总资产信息-->
			<div class="AssetsMsgBox" id="maincontent">
				<script id="assetsTmp" type="text/template">
					<article class="allAssets">
						<p class="cor_r sm">总资产</p>
						<h3 class="md">{{TotalAmount}}</h3>
					</article>
					<article class="AssetsTop">
						<p class="xs">账户余额</p>
						<h4 class="md">{{AccountAmount}}</h4>
					</article>
					<aside class="AssetsBot">
						<!--产品收益提示-->
						<div class="AssetsBotlist">
							<div class="AssetsBotlist_pic">
								<i class="iconfont icon-moshi sm"></i>
								<p class="xs">产品</p>
							</div>
							<div class="AssetsBotlist_txt">
								<p class="xs">昨日收益</p>
								<h4>{{ProductYesterdayIncome}}</h4>
							</div>
							<div class="AssetsBotlist_txt">
								<p class="xs">累计收益</p>
								<h4>{{ProductTotalIncome}}</h4>
							</div>
						</div>
						<!--企业宝收益提示-->
						<div class="AssetsBotlist">
							<div class="AssetsBotlist_pic">
								<i class="iconfont icon-group53 sm"></i>
								<p class="xs">企业宝</p>
							</div>
							<div class="AssetsBotlist_txt">
								<p class="xs">昨日收益</p>
								<h4>{{TreasureYesterdayIncome}}</h4>
							</div>
							<div class="AssetsBotlist_txt">
								<p class="xs">累计收益</p>
								<h4>{{TreasureTotalIncome}}</h4>
							</div>
						</div>
					</aside>
				</script>
			</div>

			<!--操作菜单-->
			<div class="finance">
				<h4 class="com_ti1">便捷操作</h4>
				<ul>
					<!--充值测试-->
					<li class="financelists active">
						<a href="./zh-toPay.html" hid="zh-toPay" class="a">
							<img src="../../img/zh_2.png" alt="" width="70" height="50" />
							<p>充值</p>
						</a>
					</li>
					<li class="financelists active">
						<a href="./zh-extract.html" hid="zh-extract" id="toExtract">
							<!--<a href="#" id="toExtract">-->
							<img src="../../img/zh_5.png" alt="" width="70" height="50" />
							<p>提现</p>
						</a>
					</li>
					<!--<li class="financelists active">
						<a href="./zh-welfare.html" hid="zh-welfare">
							<img src="../../img/zh_1.png" alt="" width="70" height="50" />
							<p>福利特权</p>
						</a>
					</li>-->
					<li class="financelists active">
						<a href="./zh-profit.html" hid="zh-profit" class="a">
							<img src="../../img/zh_4.png" alt="" width="70" height="50" />
							<p>收益报表</p>
						</a>
					</li>
					<li class="financelists active">
						<a href="./zh-balance.html" hid="zh-balance" class="a">
							<img src="../../img/zh_3.png" alt="" width="70" height="50" />
							<p>收支明细</p>
						</a>
					</li>
				</ul>
			</div>

			<!--个人简要信息-->
			<div class="personMsg " id="personMsg">
				<aside>
					<img src="../../img/i2.png" alt="" class="avater" id="userAvatar" />
					<h4 id="userName"></h4>
					<a hid="score" href="./score.html" class="a">
						<span class="cor_b nm">积分规则</span>
						<span class="mui-icon mui-icon-help cor_b sm"></span>

					</a>
				</aside>
				<article>
					<div class="personMsg_left">
						<div id="scoreBox">
							<img src="" alt="" height=24 width=20 id="levelPic" />
							<span id="nowLevel"></span>
						</div>
						<div>
							<p>当前积分：</p>
							<h4 id="nowScore"></h4>
						</div>
						<div>
							<p>下一等级：</p>
							<h4 id="nextLevel"></h4>
						</div>
					</div>
				</article>
				<div class="mui-demo-container">
					<p class="mui-progressbar mui-progressbar-danger" data-progress="0" id="progress"><span></span></p>
				</div>
				<div style="height: 20px;"></div>
			</div>

		</div>

		<!--导航-->
		<nav class="mui-bar mui-bar-tab" id="tabBox" style="background: #fff;">
			<a class="mui-tab-item tabs  mui-active " id="tabs1" href="1">
				<i class=" mui-icon iconfont icon-baimingdancelveweihu"></i>
				<span class="mui-tab-label">账户首页</span>
			</a>
			<a class="mui-tab-item tabs" href="2" id="tabs2">
				<i class=" mui-icon iconfont icon-anquanguanlimenhu"></i>
				<span class="mui-tab-label">企业宝</span>
			</a>
			<a class="mui-tab-item tabs" href="3" id="tabs3">
				<i class=" mui-icon iconfont icon-yewufenleiweihu"></i>
				<span class="mui-tab-label">产品</span>
			</a>
			<a class="mui-tab-item tabs" href="4" id="tabs4">
				<i class=" mui-icon iconfont  icon-xitong"></i>
				<span class="mui-tab-label">设置</span>
			</a>
		</nav>

		<script src="../../js/mui.min.js"></script>
		<script src="../../js/arttemp.js"></script>
		<script src="../../js/app.js"></script>

		<script type="text/javascript" charset="utf-8">
			mui.init({
				swipeBack: false,
				keyEventBind: {
					backbutton: false, //Boolean(默认true)关闭back按键监听
					menubutton: false //Boolean(默认true)关闭menu按键监听
				},
				statusBarBackground: '#fff'
			})

			mui.plusReady(function() {
				var wv = plus.webview.currentWebview();
				wv.setStyle({
					titleNView: {
						type: 'transparent',
						autoBackButton: false, // 标题栏文字,当不设置此属性时，默认加载当前页面的标题，并自动更新页面的标题
						titleColor: "#fff", // 字体颜色,颜色值格式为"#RRGGBB",默认值为"#000000"
						titleSize: "14px", // 字体大小,默认17px
						titleText: '企业宝欢迎您',
						backgroundColor: "#2786ca", // 控件背景颜色,颜色值格式为"#RRGGBB",默认值为"#F7F7F7"
						progress: { // 标题栏控件的进度条样式
							color: "#25eb55", // 进度条颜色,默认值为"#00FF00"  
							height: "2px" // 进度条高度,默认值为"2px"         
						},
						splitLine: { // 标题栏控件的底部分割线，类似borderBottom
							color: "#4574bc", // 分割线颜色,默认值为"#CCCCCC"  
							height: "1px" // 分割线高度,默认值为"2px"
						}
					}
				});

				//隐藏滚动条				
				plus.webview.currentWebview().setStyle({
					scrollIndicator: 'none'
				});

				window.addEventListener('test', function(event) {
					//					alert(event.detail.key)
					tabInit(event.detail.key)
				});
				//				alert(1)
				var tk = app.getState().token;
				//				记录总帐户信息,后面会传给子页面
				var allAccount
				//				预加载页面
				var page2 = app.prePage('../qyb/qiyeBao.html', 'qiyeBao')
				var page3 = app.prePage('../cp/product.html', 'product')
				var page4 = app.prePage('../set/set.html', 'set')
				//				进度条
				var progress = document.getElementById('progress')
				//				用户头像
				var userAvatar = document.getElementById('userAvatar')
				//				用户名称
				var userName = document.getElementById('userName')
				//				等级图片
				var levelPic = document.getElementById('levelPic')
				//				当前积分
				var nowScore = document.getElementById('nowScore')
				//				当前等级
				var nowLevel = document.getElementById('nowLevel')
				//				下一等级
				var nextLevel = document.getElementById('nextLevel')

				//导航栏跳转
				mui('#tabBox').on('tap', '.tabs', function() {
					var key = this.getAttribute('href')
					var arr = ['qiyeBao', 'product', 'set']
					if(key == 1) {
						for(i = 0; i < 3; i++) {
							var obj = plus.webview.getWebviewById(arr[i])
							obj.hide()
						}
					} else {
						for(i = 0; i < 3; i++) {
							var obj = plus.webview.getWebviewById(arr[i])
							if(i + 2 == key) {
								plus.webview.show(obj)
							}
						}
					}
				})

				//				提现按钮需要传参账户余额所以单独写

				mui('.finance').on('tap', '#toExtract', function() {

					mui.openWindow({
						url: './zh-extract.html',
						id: 'zh-extract',
						styles: {
							top: '0px', //新页面顶部位置
							bottom: '0px', //新页面底部位置
							scrollIndicator: "none",
							plusrequire: 'ahead'
						},
						createNew: true, //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
						show: {
							autoShow: true, //页面loaded事件发生后自动显示，默认为true
							duration: 300 //页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
						},
						extras: {
							maxAmount: allAccount.AccountAmount
						},
						waiting: {
							autoShow: true, //自动显示等待框，默认为true
							title: '正在加载...', //等待对话框上显示的提示内容
						}
					})
				})

				//				首次加载金额数据
				mui.ajax(app.baseUrl + '/Data/api/Account/AmountIncome', {
					//			dataType:'json',//服务器返回json格式数据
					type: 'post', //HTTP请求类型
					timeout: 10000, //超时时间设置为10秒；
					headers: {
						'Content-Type': 'application/x-www-form-urlencoded',
						'Authorization': tk
					},
					success: function(data) {
						if(data.Success) {
							var html = template('assetsTmp', data.Data);
							document.getElementById('maincontent').innerHTML = html;

							allAccount = data.Data
						}
					},
					error: function(xhr, type, errorThrown) {
						app.ajaxError(errorThrown)
					}
				});

				//				加载账户信息数据
				mui.ajax(app.baseUrl + '/Data/api/Account/GetUserAccount', {
					//			dataType:'json',//服务器返回json格式数据
					type: 'get', //HTTP请求类型
					timeout: 10000, //超时时间设置为10秒；
					headers: {
						'Content-Type': 'application/x-www-form-urlencoded',
						'Authorization': tk
					},
					success: function(data) {
						if(data.Success) {
							var msg = data.Data;
							progress.dataProgress = msg.INTEGRAL.UpgradeProgress * 100
							//				用户头像
							userAvatar.src = app.baseUrl + msg.STAFF_IMG
							//				用户名称
							userName.innerHTML = 'HI,' + msg.STAFF_NAME
							//				等级图片
							levelPic.src = app.localLevelPicUrl(msg.INTEGRAL.Level)
							//				当前积分
							nowScore.innerHTML = msg.INTEGRAL.IntegralNum
							//				当前等级
							nowLevel.innerHTML = msg.INTEGRAL.LevelName
							//				下一等级
							nextLevel.innerHTML = msg.INTEGRAL.NextLevelName

							//				显示进度条		
							mui("#progress").progressbar({
								progress: msg.INTEGRAL.UpgradeProgress * 100
							}).show();

						}
					},
					error: function(xhr, type, errorThrown) {
						console.log(errorThrown)
					}
				});

			})

			//			返回触发返导航栏默认首页
			function tabInit(k) {
				//				var k=k||1
				var defaultTab = document.getElementById("tabs" + k);

				var objs = document.querySelectorAll(".tabs");

				for(i = 0; i < objs.length; i++) {
					objs[i].classList.remove('mui-active')
				}
				defaultTab.classList.add('mui-active');

			}
			//			关闭欢迎页
			function closeLoad() {
				//				console.log(666)
				plus.navigator.closeSplashscreen();
			}

			function openMsgCenter() {
				app.jumpPage('../set/msgcenter.html', 'msgcenter')
			}
		</script>
	</body>

</html>